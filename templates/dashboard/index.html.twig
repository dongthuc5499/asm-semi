{% extends 'dashboard/base.html.twig' %}

{% block content %}
<div class="container-fluid">
    <div style="background: #000033; height: 200px; border-radius: 5px; width: 75.9vw; margin-bottom: 10px">
        <div class="row" style="padding-top: 40px; padding-left: 20px">
            <h3 class="text-center" style="margin-left: 10px; color: white; font-size: 40px"><b>Projects</b></h3>
            {#<a href="{{ path('dashboard_product_create') }}" class="col-2 btn "
               style="background: white; width: 200px; height: 40px"><b>Create New Product</b></a>#}
        </div>

    </div>

        <div class="d-flex justify-content-start gap-3">
            <div style="width: 400px">
                <div class="shadow" style="background: white; border-radius: 10px; width: 380px; height: 150px">
                    <div class="card-body" style="padding-left: 20px; padding-right: 20px; padding-top: 10px">
                        <div class="d-flex justify-content-between align-items-center mb-3 ">
                            <div>
                                <h4 class="">Categories</h4>
                            </div>

                        </div>
                        <div>
                            <h1 class="fw-bold">{{ totalCategories }}</h1>
                            <p class="mb-0">
                                <span classname="text-dark me-2">{{ totalCategories }}</span> Completed
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div style="width: 400px">
                <div class="shadow" style="background: white; border-radius: 10px; width: 380px; height: 150px">
                    <div class="card-body" style="padding-left: 20px; padding-right: 20px; padding-top: 10px">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <h4 class="mb-0 ">Products</h4>
                            </div>
                            {#<div class="icon-shape icon-md bg-light-primary text-primary rounded-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="18" height="18"
                                     fill="currentColor">
                                    <path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1h-3zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5zm1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0zM1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5z">
                                    </path>
                                </svg>
                            </div>#}
                        </div>
                        <div>
                            <h1 class="fw-bold">{{ totalProducts }}</h1>
                            <p class="mb-0">
                                <span classname="text-dark me-2">{{ sumQuantityProducts }}</span> All Quantity
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div style="width: 380px">
                <div style="width: 380px">
                    <div class="shadow" style="background: white; border-radius: 10px; width: 370px; height: 150px">
                        <div class="card-body" style="padding-left: 20px; padding-right: 20px; padding-top: 10px">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    <h4 class="mb-0 text-center">Users</h4>
                                </div>
                                {#<div class="icon-shape icon-md bg-light-primary text-primary rounded-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="18" height="18"
                                         fill="currentColor">
                                        <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8Zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022ZM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816ZM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z"></path>
                                    </svg>
                                </div>#}
                            </div>
                            <div>
                                <h1 class="fw-bold">{{ totalUsers }}</h1>
                                <p class="mb-0">
                                    <span class="text-dark me-2">{{ totalSuperAdmins }}</span>Admin
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Best Selling Products -->
        {#<div style="background: white; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19); border-radius: 5px">
            <h4 style="padding-left: 20px; padding: 10px; height: 50px"><b>Best Selling Products</b></h4>
            <table style="width: 100%" id="productTable">
                <tr style="background: #f1f5f9; color: #677381; height: 40px;">
                    <th style="padding-left: 20px">Product</th>
                    <th>Quantity</th>
                    <th>Users</th>
                    <th>Progress</th>
                </tr>
                {% for productId, productData in bestSellingProducts %}
                    <tr>
                        <td>
                            {% if productData.image %}
                        <img src="{{ asset('uploads/image/' ~ productData.image) }}" alt="Product Image"
                             style="max-width: 100px; max-height: 100px;">
                            {% endif %}&emsp;
                            {{ productData.name }}
                        </td>
                        <td>{{ productData.quantity }}</td>
                        <td class="avatar-stack">
                            {% set totalUsers = productData.users|length %}
                            {% for index, userId in productData.users|slice(0, 5) %}
                                <img src="{{ asset('uploads/image/' ~ userId.avatar) }}" alt="User Avatar"
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 50px;">
                            {% endfor %}
                            {% if totalUsers > 5 %}
                                <div class="overflow-count">+{{ totalUsers - 5 }}</div>
                            {% endif %}
                        </td>
                        <td style="width: 200px; padding-right: 30px">
                            {{ productData.quantity*3.5 }}%
                            <div class="progress" style="height:5px">
                                <div class="progress-bar" style="width: {{ productData.quantity*3.5 }}%"></div>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </table>
            <hr>
            <div style="text-align: center;">
                <a href="javascript:void(0);" id="viewAllBtn" style="font-size: 18px">View All Projects</a>
            </div>
        </div> #}

    </div>

    <style>
        .shadow {
            width: 250px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            text-align: center;
        }

        .icon-shape {
            background: #ecddfc;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-shape svg {
            color: rgb(193, 86, 118);
        }

        .avatar-stack {
            display: flex;
            align-items: center;
        }

        .avatar-stack img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
            margin-right: -10px;
            border: 2px solid #ffffff;
        }

        .avatar-stack .overflow-count {
            background-color: #ffffff;
            color: #000000;
            width: 50px;
            height: 50px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
    <script>
        // Add JavaScript for the "View All Projects" button toggle
        document.addEventListener("DOMContentLoaded", function () {
            const productTable = document.getElementById("productTable");
            const viewAllBtn = document.getElementById("viewAllBtn");
            const products = productTable.getElementsByTagName("tr");
            const maxVisibleProducts = 10;

            // Function to show/hide products in the table
            function toggleProducts() {
                for (let i = 1; i < products.length; i++) {
                    if (i <= maxVisibleProducts || viewAllBtn.dataset.showAll === "true") {
                        products[i].style.display = "table-row";
                    } else {
                        products[i].style.display = "none";
                    }
                }
            }

            // Toggle "View All Projects" button text and behavior
            viewAllBtn.dataset.showAll = "false";
            viewAllBtn.addEventListener("click", function () {
                viewAllBtn.dataset.showAll = viewAllBtn.dataset.showAll === "true" ? "false" : "true";
                viewAllBtn.textContent = viewAllBtn.dataset.showAll === "true" ? "View Less Projects" : "View All Projects";
                toggleProducts();
            });

            // Initially show only limited products
            toggleProducts();
        });
    </script>
    {% endblock %}
